<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éšœå®³ã‚¿ã‚¤ãƒ æ¯”è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>
    <style>
        :root { --primary: #1b4332; --bg: #f4f7f6; --accent: #2980b9; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #2c3e50; }
        .container { max-width: 500px; margin: 0 auto; }
        .card { background: white; padding: 18px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        h3 { margin-top: 0; color: var(--primary); font-size: 16px; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
        
        label { display: block; font-size: 12px; font-weight: bold; color: #7f8c8d; margin-top: 10px; margin-bottom: 4px; }
        select, input { width: 100%; padding: 12px; border: 1px solid #cbd5e0; border-radius: 4px; font-size: 16px; box-sizing: border-box; background-color: white; }
        
        .btn-main { width: 100%; background: var(--primary); color: white; padding: 16px; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        
        .record-info-box { font-size: 13px; color: #4a5568; background: #f8f9fa; padding: 12px; border-radius: 4px; margin-top: 10px; border-left: 4px solid var(--primary); display: none; line-height: 1.5; }
        
        #resultArea { margin-top: 20px; border-top: 2px solid #eee; padding-top: 15px; display: none; text-align: center; }
        .ratio-val { font-size: 32px; font-weight: bold; color: var(--primary); margin: 5px 0; }
        .rank-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 14px; font-weight: bold; margin-bottom: 10px; }
        
        .rank-s { background: #fff5f5; color: #c53030; border: 1px solid #feb2b2; }
        .rank-a { background: #fffaf0; color: #c05621; border: 1px solid #fbd38d; }
        .rank-b { background: #f0fff4; color: #276749; border: 1px solid #9ae6b4; }
        .rank-c { background: #edf2f7; color: #4a5568; border: 1px solid #cbd5e0; }

        /* ãƒ¬ã‚³ãƒ¼ãƒ‰è¡¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        details { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-top: 10px; overflow: hidden; }
        summary { padding: 15px; font-size: 14px; font-weight: bold; color: var(--primary); cursor: pointer; list-style: none; border-bottom: 1px solid #eee; }
        .record-list-content { padding: 10px; background: #fff; font-size: 11px; max-height: 500px; overflow-y: auto; }
        
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; table-layout: fixed; }
        th { background: #f1f3f1; color: var(--primary); text-align: left; padding: 6px; font-size: 11px; border-bottom: 2px solid #ddd; }
        td { padding: 8px 6px; border-bottom: 1px solid #eee; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .venue-header { background: var(--primary); color: white; font-weight: bold; padding: 4px 10px; font-size: 12px; }
        .col-dist { width: 25%; }
        .col-time { width: 20%; font-weight: bold; }
        .col-horse { width: 30%; }
        .col-date { width: 25%; color: #888; text-align: right; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h3>éšœå®³ã‚¿ã‚¤ãƒ æ¯”è¨ˆç®—</h3>
        
        <label>ç«¶é¦¬å ´</label>
        <select id="venue" onchange="updateCourse()">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="nakayama">ä¸­å±±</option>
            <option value="tokyo">æ±äº¬</option>
            <option value="kyoto">äº¬éƒ½</option>
            <option value="hanshin">é˜ªç¥</option>
            <option value="niigata">æ–°æ½Ÿ</option>
            <option value="kokura">å°å€‰</option>
            <option value="fukushima">ç¦å³¶</option>
        </select>

        <label>ã‚³ãƒ¼ã‚¹ / è·é›¢</label>
        <select id="course" onchange="displayRecord()">
            <option value="">ç«¶é¦¬å ´ã‚’å…ˆã«é¸ã‚“ã§ãã ã•ã„</option>
        </select>

        <div id="recordInfo" class="record-info-box"></div>

        <label>èµ°ç ´ã‚¿ã‚¤ãƒ  (ä¾‹ 3:15.2 ã¾ãŸã¯ 315.2)</label>
        <input type="text" id="timeInput" placeholder="åˆ†:ç§’.ãƒŸãƒª" inputmode="decimal">

        <button class="btn-main" onclick="calculate()">åˆ¤å®šã‚’å®Ÿè¡Œ</button>

        <div id="resultArea">
            <div id="rankBadge" class="rank-badge">---</div>
            <div class="ratio-val" id="ratioResult">0.00%</div>
            <div id="commentText" class="comment" style="font-size: 13px; color: #718096;"></div>
        </div>
    </div>

    <details>
        <summary>ğŸ“Š éšœå®³ã‚³ãƒ¼ã‚¹ ãƒ¬ã‚³ãƒ¼ãƒ‰ä¸€è¦§ã‚’è¡¨ç¤º</summary>
        <div class="record-list-content" id="masterRecordList"></div>
    </details>
</div>

<script>
const db = {
    nakayama: { label: "ä¸­å±±", data: [
        { name: "èŠ3100m", record: 184.2, date: "2018/4/14", horse: "ã‚ªã‚¸ãƒ¥ã‚¦ãƒãƒ§ã‚¦ã‚µãƒ³" },
        { name: "èŠ4250m", record: 252.3, date: "2024/4/13", horse: "ã‚¤ãƒ­ã‚´ãƒˆã‚·" }
    ]},
    tokyo: { label: "æ±äº¬", data: [
        { name: "èŠ3000m", record: 194.3, date: "2013/6/22", horse: "ã‚¢ãƒãƒ­ãƒãƒ¼ãƒ™ãƒªãƒƒã‚¯" },
        { name: "èŠ3110m", record: 201.1, date: "2020/10/18", horse: "ãƒ•ã‚©ã‚¤ãƒ¤ãƒ¼ãƒ´ã‚§ãƒ«ã‚¯" },
        { name: "èŠ3300m", record: 193.3, date: "2021/6/26", horse: "ãƒ©ãƒ´ã‚¢ãƒ³ãƒ‰ãƒãƒƒãƒ—" }
    ]},
    kyoto: { label: "äº¬éƒ½", data: [
        { name: "èŠ2910m", record: 176.6, date: "2023/11/11", horse: "ã‚¨ã‚³ãƒ­ãƒ‡ãƒ¥ã‚¨ãƒ«" },
        { name: "èŠ3170m", record: 186.2, date: "2024/5/25", horse: "ã‚µã‚¯ã‚»ã‚¹ã‚¨ãƒ¼ã‚¹" },
        { name: "èŠ3930m", record: 262.4, date: "2024/5/11", horse: "ãƒã‚¤ãƒãƒ«ã‚°ãƒ­ãƒ³" }
    ]},
    hanshin: { label: "é˜ªç¥", data: [
        { name: "èŠ2970m", record: 178.5, date: "2021/4/17", horse: "ãƒã‚¤ãƒãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ" },
        { name: "èŠ3110m", record: 186.7, date: "2024/3/9", horse: "ãƒã‚¤ãƒãƒ«ã‚°ãƒ­ãƒ³" },
        { name: "èŠ3140m", record: 189.2, date: "2023/12/2", horse: "ãƒ­ãƒƒã‚¯ãƒ¦ãƒ¼" }
    ]},
    niigata: { label: "æ–°æ½Ÿ", data: [
        { name: "èŠ2850m", record: 172.1, date: "2024/7/27", horse: "ã‚µã‚¯ã‚»ã‚¹ã‚¨ãƒ¼ã‚¹" },
        { name: "èŠ2890m", record: 175.7, date: "2021/7/31", horse: "ãƒˆã‚¥ãƒ«ãƒœãƒ¼" },
        { name: "èŠ3250m", record: 198.8, date: "2024/5/18", horse: "ã‚µãƒšãƒ©ãƒ´ã‚£" }
    ]},
    kokura: { label: "å°å€‰", data: [
        { name: "èŠ2860m", record: 181.1, date: "2023/2/11", horse: "ãƒ†ãƒ¼ã‚ªãƒ¼ã‚½ã‚¯ãƒ©ãƒ†ã‚¹" },
        { name: "èŠ3390m", record: 220.2, date: "2022/8/27", horse: "ã‚¸ã‚§ãƒŸãƒ‹ã‚­ãƒ³ã‚°" }
    ]},
    fukushima: { label: "ç¦å³¶", data: [
        { name: "èŠ2750m", record: 188.1, date: "2022/11/5", horse: "ãƒ†ãƒ¼ã‚ªãƒ¼ã‚½ã‚¯ãƒ©ãƒ†ã‚¹" },
        { name: "èŠ2770m", record: 191.1, date: "2023/4/8", horse: "ãƒ€ã‚¤ã‚·ãƒ³ã‚¯ãƒ­ãƒ¼ãƒãƒ¼" },
        { name: "èŠ3350m", record: 224.2, date: "2024/7/20", horse: "ã‚µã‚¯ã‚»ã‚¹ã‚¨ãƒ¼ã‚¹" },
        { name: "èŠ3380m", record: 224.6, date: "2022/7/23", horse: "ãƒ›ãƒƒã‚³ãƒ¼ãƒ¡ãƒ´ã‚£ã‚¦ã‚¹" }
    ]}
};

function initRecordList() {
    const listContainer = document.getElementById('masterRecordList');
    let html = "";
    for (const key in db) {
        html += `<div class="venue-header">${db[key].label}</div>`;
        html += `<table><thead><tr><th class="col-dist">è·é›¢</th><th class="col-time">ã‚¿ã‚¤ãƒ </th><th class="col-horse">ä¿æŒé¦¬</th><th class="col-date">è¨˜éŒ²æ—¥</th></tr></thead><tbody>`;
        db[key].data.forEach(item => {
            const m = Math.floor(item.record / 60);
            const s = (item.record % 60).toFixed(1);
            html += `<tr>
                        <td>${item.name}</td>
                        <td class="col-time">${m}:${s.padStart(4, '0')}</td>
                        <td>${item.horse}</td>
                        <td class="col-date">${item.date}</td>
                     </tr>`;
        });
        html += `</tbody></table>`;
    }
    listContainer.innerHTML = html;
}
initRecordList();

function updateCourse() {
    const venue = document.getElementById('venue').value;
    const courseSelect = document.getElementById('course');
    const recordBox = document.getElementById('recordInfo');
    courseSelect.innerHTML = '<option value="">ã‚³ãƒ¼ã‚¹ã‚’é¸æŠ</option>';
    recordBox.style.display = 'none';
    if (venue && db[venue]) {
        db[venue].data.forEach((item, index) => {
            const opt = document.createElement('option');
            opt.value = index;
            opt.innerText = item.name;
            courseSelect.appendChild(opt);
        });
    }
}

function displayRecord() {
    const venue = document.getElementById('venue').value;
    const index = document.getElementById('course').value;
    const recordBox = document.getElementById('recordInfo');
    if (venue && index !== "") {
        const data = db[venue].data[index];
        const m = Math.floor(data.record / 60);
        const s = (data.record % 60).toFixed(1);
        recordBox.innerHTML = `ğŸ <b>ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼š${m}:${s.padStart(4, '0')}</b><br>ğŸ ${data.horse}<br>ğŸ“… ${data.date}`;
        recordBox.style.display = 'block';
    } else {
        recordBox.style.display = 'none';
    }
}

function calculate() {
    const venue = document.getElementById('venue').value;
    const index = document.getElementById('course').value;
    const timeVal = document.getElementById('timeInput').value.trim();

    if (!venue || index === "" || !timeVal) return alert("å…¥åŠ›ä¸è¶³ã§ã™");

    let totalSeconds = 0;
    if (timeVal.includes(':')) {
        const parts = timeVal.split(':');
        totalSeconds = (parseFloat(parts[0]) * 60) + parseFloat(parts[1]);
    } else {
        const m = Math.floor(parseFloat(timeVal) / 100);
        const s = parseFloat(timeVal) % 100;
        totalSeconds = (m * 60) + s;
    }

    if (isNaN(totalSeconds) || totalSeconds <= 0) return alert("ã‚¿ã‚¤ãƒ ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“");

    const record = db[venue].data[index].record;
    const ratio = (totalSeconds / record) * 100;
    
    document.getElementById('resultArea').style.display = 'block';
    document.getElementById('ratioResult').innerText = ratio.toFixed(2) + "%";
    
    const rb = document.getElementById('rankBadge');
    const ct = document.getElementById('commentText');
    rb.className = 'rank-badge';
    
    if (ratio < 101.5) {
        rb.innerText = "ãƒ©ãƒ³ã‚¯Sï¼šè¶…æŠœç´š"; rb.classList.add('rank-s');
        ct.innerText = "ç•°æ¬¡å…ƒã®æ™‚è¨ˆã§ã™ã€‚é‡è³åˆ¶è¦‡ãƒ¬ãƒ™ãƒ«ã€‚";
    } else if (ratio < 103.0) {
        rb.innerText = "ãƒ©ãƒ³ã‚¯Aï¼šå„ªç§€"; rb.classList.add('rank-a');
        ct.innerText = "æ˜‡ç´šã—ã¦ã‚‚å³å‹ã¡è² ã‘ã§ãã‚‹ã‚¹ãƒ”ãƒ¼ãƒ‰ã§ã™ã€‚";
    } else if (ratio < 104.5) {
        rb.innerText = "ãƒ©ãƒ³ã‚¯Bï¼šæ¨™æº–"; rb.classList.add('rank-b');
        ct.innerText = "ã“ã®ã‚¯ãƒ©ã‚¹ã®å¹³å‡çš„ãªæ°´æº–ã§ã™ã€‚";
    } else {
        rb.innerText = "ãƒ©ãƒ³ã‚¯Cï¼šä½èª¿"; rb.classList.add('rank-c');
        ct.innerText = "æ™‚è¨ˆã‚’è¦ã—ã¾ã—ãŸã€‚é¦¬å ´ã‚„ãƒŸã‚¹ã®æœ‰ç„¡ã‚’ç¢ºèªã€‚";
    }
}
</script>
</body>
</html>
